# **Удалённое администирование Windows с помощью Ubuntu**

## Описание

Инструкция, подготовленная для выполнения задания, выданного в ходе прохождения производственной практики.

## Задание

1. Создать загрузочный USB-носитель дистрибутива Ubuntu;
2. Установить Ubuntu;
3. Подключиться к удалённому рабочему столу Windows используя RDP;
4. Реализовать автоматическое подключение к Windows после загрузки системы.

## Установка Ubuntu

### 1 Создание загрузочного USB-носителя

Для создания загрузочного USB-носителя нам потребуется:

- USB-накопитель на 8 Гб и больше
- [Ubuntu-releases] - хранилище версий дистрибутива Ubuntu
- [Rufus] - утилита, которая помогает форматировать и создавать загрузочные диски, карты памяти и т.д.

##### 1.1 Устанавливаем *.iso* образ дистрибутива

В нашем случае мы будем использовать *Ubuntu 16.x Desktop 32-bit*

![Изображение](https://images2.imgbox.com/8f/73/Kz8uPqYf_o.png)

##### 1.2 Устанавливаем Rufus

Для этого нажимаем на гиперссылку с последней версией Rufus (В нашем случае - *Rufus 3.17*)

![Изображение](https://images2.imgbox.com/e0/d1/CYsfp83A_o.png)

##### 1.3 Открытие образа

- Выберите USB-накопитель;
- Укажите путь к загруженному образу Ubuntu;
- Выберите целевую систему;
- Нажмите `Start`;
- В появившихся окнах нажмите `ОК`;
- Дождитесь окончания создания образа.

![Изображение](https://images2.imgbox.com/88/7b/5ZepBmYF_o.png)

### 2 Установка системы

Для установки *Ubuntu 16.x Desktop x32* потребуются следующие характеристики системы:

| Комплектующее | Требование |
| ------ | ------ |
| Процессор | 2 ГГц двухъядерный процессор или выше |
| Оперативная память | 2 ГБ RAM или выше |
| Место на жёстком диске | 25 ГБ свободного места на жёстком диске |

##### 2.1 Загрузка в систему

В BIOS установите загрузочным диском USB-накопитель с установленным на нём образом Ubuntu

##### 2.2 Начало установки

Для начала установки

- Выберите язык;
- Нажмите кнопку `Install Ubuntu`.

В нашем случае мы использовали английский язык - *English*

![Изображение](https://images2.imgbox.com/9b/5b/ZP4Wxzj9_o.png)

##### 2.3 Установка обновлений

- Если вы желаете установить обновления сразу, укажите пункт "*Download updates while installing Ubuntu*", мы же установим обновления позже;
- Нажмите `Continue`.

![Изображение](https://images2.imgbox.com/39/b1/3MJMgAx4_o.png)

##### 2.4 Начните установку файлов системы

Для начала установки основных файлов системы

- Нажмите `Install Now`;
- Нажмите `Continue`.

![Изображение](https://images2.imgbox.com/eb/d1/dTMQUGNc_o.png)

##### 2.5 Выберите часовой пояс

- Укажите часовой пояс;
- Нажмите `Continue`.

![Изображение](https://images2.imgbox.com/7d/41/kh1rDNQp_o.png)

##### 2.6 Укажите раскладку клавиатуры

- Выберите языковой пакет;
- Укажите язык;
- Нажмите `Continue`.

![Изображение](https://images2.imgbox.com/39/1f/X5dfaNGW_o.png)

##### 2.7 Создание пользователя

Для создания пользователя требуется указать:

- `Имя пользователя`;
- `Имя компьютера`;
- `Логин`;
- `Пароль`;
- `Повторение пароля`;
- После заполнения полей нажмите `Continue`.

![Изображение](https://images2.imgbox.com/6a/f8/3gFEJ1Fj_o.png)

##### 2.8 Завершение установки

Дождитесь окончания установки Ubuntu, нажмите `Restart now`

![Изображение](https://images2.imgbox.com/9d/4a/TtqfEBwg_o.png)

### 3 Настройка системы

##### 3.1 Вход в пользователя

Укажите `Логин` и `Пароль` пользователя, который вы указывали раньше и нажмите клавишу `Enter`

##### 3.2 Настройка интернет-соединения

3.2.1 Для настройки интернет-соединения нажмите на кнопку интернет, `Edit connections...`

![Изображение](https://images2.imgbox.com/e1/d1/MLOJzghJ_o.png)

3.2.2 Выберите сетевой интерфейс, нажмите кнопку `Edit`

![Изображение](https://images2.imgbox.com/4c/94/kSdzV3M6_o.png)

У вас откроется окно изменения сетевого интерфейса

3.2.3 Откройте вкладку `IPv4 Settings`

- Выберите метод "*Manual*";
- Нажмите `Add`;
- Укажите IP-адрес компьютера, укажите маску, шлюз и DNS-сервер;
- Нажмите кнопку `Save`.

![Изображение](https://images2.imgbox.com/f4/10/rQcBTStn_o.png)

3.2.4 Проверка интернет соединения

- Откройте терминал;
- Введите команду, указанную ниже.

```sh
ping -с 3 example.com
```

В результате выполнения команды должен быть получен следующий результат:

![Изображение](https://images2.imgbox.com/9a/9e/p7GQDPAY_o.png)

### 4 Создание конфигурации подключения *.remmina*

##### 4.1 Открытие Remmina

Нажмите кнопку `Search`, введите *Remmina*

![Изображение](https://images2.imgbox.com/50/f7/gAWC1PrB_o.png)

##### 4.2 Настройка программы Remmina

Для настройки программы нажмите кнопку `Open the preferences dialog`;
Откроектся окно "*Remmina preferences*";

Укажите следующие настройки во вкладке `Options`:

| Настройка | Значение |
| ------ | ------ |
| Remember last view mode for each connection | `True` |
| Save settings when starting the connection | `True` |
| Invisible toolbar in fullscreen mode | `True` |
| Always show tabs | `False` |
| Hide toolbar in tabbed interface | `False` |
| Double-click action | - |
| Default view mode | `Scrolled fullscreen` |
| Tab interface | `Do not use tabs` |
| Scale quality | `Hyper` |
| SSH tunnel local port | 4732 |
| Auto scroll step size | 10 |
| Maximum recent items | 10 |

![Изображение](https://images2.imgbox.com/0d/24/YorhiFmi_o.png)

При необходимости, горячие клавиши программы Remmina можно изменить во вкладке `Keyboard`:

![Изображение](https://images2.imgbox.com/f2/51/ahCCBRHB_o.png)

##### 4.3 Создание файла конфигурации

Настройки подключения к удалённому рабочему столу сохряняются в специальных *.remmina* файлах, расположенных в каталоге **/home/ubuntu/.remmina/**;
Для создания файла конфигурации, нажмите кнопку `New`

![Изображение](https://images2.imgbox.com/50/9b/QyMCenz8_o.png)

##### 4.4 Настройка подключения

Укажите следующие настройки (Обязательно измените имя профиля, чтобы открылась возможность сохранить конфигурацию):

| Настройка | Значение |
| ------ | ------ |
| Name | *Название конфигурации* |
| Group | - |
| Protocol | *RDP - Remote Desktop Protocol* |

###### 4.4.1 Вкладка `Basic`

| Настройка | Значение |
| ------ | ------ |
| Server | *IP-адрес машины* |
| User name | *Имя пользователя удалённой машины* |
| Password | *Пароль пользователя удалённой машины* |
| Domain | *Домен* |
| Resolution | - |
| Color depth | `256 colors (8 bpp)` |
| Share folder | - |

![Изображение](https://images2.imgbox.com/e0/45/6AhfZjhw_o.png)

###### 4.4.2 Вкладка `Advanced`

| Настройка | Значение |
| ------ | ------ |
| Quality | *Качество подключения, рекоммендовано - Medium* |
| Sound | `Local` |
| Security | `TLS` |
| Client name | - |
| Startup program | - |
| Startup path | - |
| Share local printers | `True` |

![Изображение](https://images2.imgbox.com/0a/36/fdWHi4WA_o.png)

После настройки подключения нажмите кнопку `Save`

##### 4.5 Узнаём имя файла конфигурации

После сохранения файла, нажмите на конфигурацию в программе Remmina и запомните путь к файлу конфигурации:

![Изображение](https://images2.imgbox.com/7b/ac/6WDnX1ge_o.png)

##### 4.6 Подключение к удалённому рабочему столу

Есть 2 варианта подключения к удалённому рабочему столу:

- С помощью программы Remmina;
- С помощью команды в терминале.

Для подключения к удалённому серверу с помощью программы Remmina нужно:
1. Открыть программу;
2. Выбрать конфигурацию подключения;
3. Нажать кнопку `Connect`.

![Изображение](https://images2.imgbox.com/03/0b/yurSrRnW_o.png)

Для подключения к удалённому серверу с помощью терминала требуется

1. Открыть терминал;
2. Выполнить команду:

```sh
remmina -c /home/[имя_пользователя]/[ID_конфигурации].remmina
```

### 5 Автоматический запуск Remmina после авторизации пользователя

Для создания процесса автоматического запуска потребуется:

1. Создать скрипт запуска программы с параметрами;
2. Добавить созданный скрипт в автозапуск Ubuntu.

##### 5.1 Создание скрипта запуска

###### 5.1.1 Базис

Для того, чтобы создать скрипт запуска программы Remmina с параметрами, нам потребуется изучить структуру обычного *.sh* скрипта в Ubuntu:

*Скрипт для примера*

```sh
#!/bin/bash
 
mkdir scripts
cd scripts
touch f1 f2 f3
ls -al
```

Все *.sh* скрипты включают:

1. Обязательная для файлов *.sh* строка, указывающая, что перед нами именно shell-скрипт.
2. Далее идет последовательность команд — 1 строка — одна команда. В приведённом примере мы сначала создаем папку scripts, далее переходим в нее и создаем там три файла. В последней строке мы выводим на экран список файлов с текущей директории — т.е. видим три наших новосозданных файла.

###### 5.1.2 Создание директории для скриптов

Создаём директорию для хранения скриптов:

```sh
mkdir /home/[имя_пользователя]/scripts
```

Переходим в созданную директорию:

```sh
cd /home/[имя_пользователя]/scripts
```

###### 5.1.3 Создание скрипта

Создаём скрипт *StartupScript* *(имя файла можно поменять)*:

```sh
sudo nano StartupScript.sh
```

Вводим пароль пользователя, после чего открывается текстовый редактор nano:

![Изображение](https://images2.imgbox.com/ae/73/jUYKSmOt_o.png)

В текстовом редакторе вводим:

```sh
#!/bin/bash

remmina -c /home/[имя_пользователя]/[ID_конфигурации].remmina
```

Результат ввода указан ниже:

![Изображение](https://images2.imgbox.com/af/e3/W7mBYx9a_o.png)

Для сохранения файла скрипта требуется нажать последовательность клавиш:

1. `Ctrl` + `X` для выхода из редактора nano
2. `Y` для сохранения модификаций файла
3. `Enter` для подтверждения имени файла

Далее требуется сделать файл исполняемым. Для этого вводим команду:

```sh
chmod +x StartupScript.sh
```

##### 5.2 Создание задачи автозапуска скрипта

Для создания задачи запуска исполняемого скрипта, для начала проверим его работоспособность:

```sh
sh /home/[имя_пользователя]/scripts/StartupScript.sh
```

После проверки открываем автозагрузки, расположенные в приложении Startup Applications:

![Изображение](https://images2.imgbox.com/0e/f1/kovyUYix_o.png)

После открытия Startup Applications требуется:

1. Нажать клавишу `Add`;
2. В открывшейся форме ввести название процесса;
3. Ввести команду:

```sh
sh /home/[имя_пользователя]/scripts/StartupScript.sh
```

4. Ввести комментарий/описание процесса (опционально);
5. Нажать клавишу `Add`;

## Заключение

Теперь, после каждого включения хост-машины будет автоматически включаться *.sh*-скрипт, который будет выполнять команду запуска remmina с параметрами указанного конфигурационного файла

## Инструкцию подготовил

Цыганок Василий

## Задание выполнили:

Цыганок Василий Александрович, [GitHub-ReZuCoS]

##### 14.11.2021

[GitHub-ReZuCoS]: <https://github.com/ReZuCoS/> "Нажмите для перехода"
[GitHub-Nikita2001D]: <https://github.com/Nikita2001D/> "Нажмите для перехода"
[Ubuntu-releases]: <https://releases.ubuntu.com/> "Нажмите для перехода"
[Rufus]: <http://rufus.ie/en/> "Нажмите для перехода"
